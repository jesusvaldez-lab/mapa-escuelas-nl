<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Mapa de Centros Educativos – Nuevo León</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- PapaParse -->
  <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    .popup h3 {
      margin: 0 0 6px 0;
      font-size: 14px;
    }

    .popup p {
      margin: 2px 0;
      font-size: 12px;
    }
  </style>
</head>

<body>

<div id="map"></div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTc8SnyCU9h9CJNb0RMYIkT4EGuRCfIzKgg9AjsxAQ6udiPbws3fmLybJp1b_TREq29YrcJn3qmMyC-/pub?gid=0&single=true&output=csv";

/* MAPA */
const map = L.map("map").setView([25.67, -100.31], 8);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap"
}).addTo(map);

/* CSV */
Papa.parse(CSV_URL, {
  download: true,
  header: true,
  skipEmptyLines: true,

  complete: function (results) {
    results.data.forEach(row => {

      const lat = parseFloat(row.LATITUD);
      const lng = parseFloat(row.LONGITUD);

      if (isNaN(lat) || isNaN(lng)) return;

      const popup = `
        <div class="popup">
          <h3>${row.NOMBRE}</h3>
          <p><b>CCT:</b> ${row.CCT}</p>
          <p><b>Nivel:</b> ${row.NIVEL}</p>
          <p><b>Turno:</b> ${row.TURNO}</p>
          <p>
            <b>Dirección:</b><br>
            ${row.CALLE} ${row.NUMERO}, ${row.COLONIA}<br>
            ${row.MUNICIPIO}, ${row.ESTADO}<br>
            CP ${row["CODIGO POSTAL"]}
          </p>
        </div>
      `;

      L.marker([lat, lng])
        .addTo(map)
        .bindPopup(popup);
    });
  }
});
</script>

</body>
</html>
