<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mapa de Escuelas NL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-o9N1j7kGStpJr0v+U2Cq6iYG5PaY5E9O+V1x0zE2r3A="
  crossorigin="">
</script>

<script>
/* =====================================================
   1. URL DEL CSV (LA TUYA, YA CORRECTA)
   ===================================================== */
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTc8SnyCU9h9CJNb0RMYIkT4EGuRCfIzKgg9AjsxAQ6udiPbws3fmLybJp1b_TREq29YrcJn3qmMyC-/pub?gid=0&single=true&output=csv";

/* =====================================================
   2. INICIALIZAR MAPA
   ===================================================== */
const map = L.map("map").setView([25.6866, -100.3161], 9);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19,
  attribution: "© OpenStreetMap"
}).addTo(map);

/* =====================================================
   3. CARGAR CSV
   ===================================================== */
fetch(CSV_URL)
  .then(res => res.text())
  .then(csv => procesarCSV(csv))
  .catch(err => console.error("Error cargando CSV:", err));

/* =====================================================
   4. PROCESAR CSV
   FORMATO ESPERADO:
   CCT,NOMBRE,NIVEL,TURNO,CALLE,NUMERO,COLONIA,
   MUNICIPIO,CODIGO POSTAL,ESTADO,LATITUD,LONGITUD
   ===================================================== */
function procesarCSV(texto) {

  const lineas = texto.trim().split("\n");

  // quitar encabezado
  lineas.shift();

  lineas.forEach(linea => {

    if (!linea.trim()) return;

    const columnas = linea.split(",");

    const cct        = columnas[0];
    const nombre     = columnas[1];
    const nivel      = columnas[2];
    const turno      = columnas[3];
    const calle      = columnas[4];
    const numero     = columnas[5];
    const colonia    = columnas[6];
    const municipio  = columnas[7];
    const cp         = columnas[8];
    const estado     = columnas[9];
    const latitud    = parseFloat(columnas[10]);
    const longitud   = parseFloat(columnas[11]);

    if (isNaN(latitud) || isNaN(longitud)) return;

    const direccion = `
      ${calle} ${numero}<br>
      Col. ${colonia}<br>
      ${municipio}, ${estado}<br>
      CP ${cp}
    `;

    L.marker([latitud, longitud])
      .addTo(map)
      .bindPopup(`
        <strong>${nombre}</strong><br><br>
        <strong>CCT:</strong> ${cct}<br>
        <strong>Nivel:</strong> ${nivel}<br>
        <strong>Turno:</strong> ${turno}<br><br>
        <strong>Dirección:</strong><br>
        ${direccion}
      `);
  });
}
</script>

</body>
</html>
