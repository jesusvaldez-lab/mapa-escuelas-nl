<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Mapa de Centros Educativos ‚Äì Nuevo Le√≥n</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- PapaParse -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
}
#map {
  width: 100%;
  height: 100vh;
}
.popup h3 {
  margin: 0 0 4px 0;
  font-size: 14px;
}
.popup p {
  margin: 2px 0;
  font-size: 12px;
}
</style>
</head>

<body>
<div id="map"></div>

<script>
/* =========================
   CONFIG
   ========================= */

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vT8WuSFX6UeAZioZlDRllmPe2FAfkIVHH-nUo1JbxTCMjbv_TfSJtP8R_LhGwiNCzrI0g1WJ0263NF_/pub?gid=1655227795&single=true&output=csv";

/* =========================
   MAPA
   ========================= */

const map = L.map("map").setView([25.67, -100.31], 9);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "¬© OpenStreetMap"
}).addTo(map);

/* =========================
   CSV
   ========================= */

Papa.parse(CSV_URL, {
  download: true,
  header: false,
  skipEmptyLines: true,

  complete: function (res) {

    console.log("Filas totales:", res.data.length);

    res.data.slice(1).forEach(row => {

      const cct        = row[0];
      const turno      = row[2];
      const nombre     = row[3];
      const nivel      = row[5];
      const municipio  = row[12];
      const domicilio  = row[15];
      const colonia    = row[19];
      const cp         = row[21];

      // üî¥ √çNDICES CORRECTOS (CONFIRMADOS)
      const lng = parseFloat(row[33]); // -100.17178
      const lat = parseFloat(row[34]); // 25.68177

      if (Number.isNaN(lat) || Number.isNaN(lng)) return;

      const popup = `
        <div class="popup">
          <h3>${nombre || ""}</h3>
          <p><b>CCT:</b> ${cct || ""}</p>
          <p><b>Nivel:</b> ${nivel || ""}</p>
          <p><b>Turno:</b> ${turno || ""}</p>
          <p><b>Direcci√≥n:</b> ${domicilio || ""}, ${colonia || ""}, ${municipio || ""}, CP ${cp || ""}</p>
        </div>
      `;

      L.circleMarker([lat, lng], {
        radius: 3,
        color: "#0066ff",
        fillOpacity: 0.7
      })
      .addTo(map)
      .bindPopup(popup);
    });
  }
});
</script>
</body>
</html>
